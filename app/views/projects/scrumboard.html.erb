<h1>Scrumboard</h1>

<div class="ui top pointing secondary attached tabular menu">
  <% @project.sprints.each_with_index do |sprint, i| %>
    <a class="item <%= 'active' if i == 0 %>" data-tab="tab-<%= sprint.id %>"><%= sprint.name %></a>
  <% end %>
</div>

<% @project.sprints.each_with_index do |sprint, i| %>
<div class="ui bottom attached tab segment <%= 'active' if i == 0 %>" data-tab="tab-<%= sprint.id %>">
  <table class="ui very compact celled table">
    <thead>
      <tr>
        <th width="25%">Para fazer</th>
        <th width="25%">Fazendo</th>
        <th width="25%">Teste</th>
        <th width="25%">Conclu√≠do</th>
      </tr>
    </thead>

    <tbody>
      <tr>
        <td class="top aligned">

        <% sprint.user_stories.each do |us| %>
          
          <%= render partial: 'projects/modal_tasks', locals: {us: us} %>

          <% us.tasks.where(status: 1).each do |task| %>
            <p></p>
            <!-- CARD -->
            <div class="ui orange card">
              <div class="content">
                <div class="header">Tarefa</div>
                <div class="meta">
                  <span class="category"><%= task.description %></span>
                </div>
                <div class="description">
                  <% if task.abilities.count > 0 %>
                  <p>
                    <strong>
                      <i class="gift icon"></i>
                      Recompensa(s):
                    </strong><br>
                    <%= us.story_points %> pontos de XP na(s) Skill(s):
                    <% task.abilities.each do |a| %>
                      <br>- <%= a.name %>
                    <% end %>
                  </p>
                  <% end %>

                  <p>
                    <a href="#" data-modal="usertory-<%= us.id %>" class="ui compact mini button modal-task">
                      <i class="search icon"></i>
                      Detalhes
                    </a>

                    <%= link_to take_task_path(task.id), class: 'ui compact mini teal button' do %>
                      <i class="share icon"></i>
                      Fazer
                    <% end %>
                  </p>

                </div>
              </div>
              <div class="extra content">
                <div class="right floated author">
                  <% task.users.each do |u| %>
                    <%= image_tag 'image.svg', class: 'ui avatar image' %> <%= u.name %>
                  <% end %>
                  <%# image_tag 'image.svg', class: 'ui avatar image' %> <!-- Sicrano -->
                </div>
              </div>
            </div>
          <% end %>
          <!-- /CARD -->
          <% end %>

        </td>

        <td class="top aligned">
          <% sprint.user_stories.each do |us| %>
          
          <%# render partial: 'projects/modal_tasks', locals: {us: us} %>

          <% us.tasks.where(status: 2).each do |task| %>
            <p></p>
            <!-- CARD -->
            <div class="ui teal card">
              <div class="content">
                <div class="header">Tarefa</div>
                <div class="meta">
                  <span class="category"><%= task.description %></span>
                </div>
                <div class="description">
                  <% if task.abilities.count > 0 %>
                  <p>
                    <strong>
                      <i class="gift icon"></i>
                      Recompensa(s):
                    </strong><br>
                    <%= us.story_points %> pontos de XP na(s) Skill(s):
                    <% task.abilities.each do |a| %>
                      <br>- <%= a.name %>
                    <% end %>
                  </p>
                  <% end %>

                  <p>
                    <a href="#" data-modal="usertory-<%= us.id %>" class="ui compact mini labeled button modal-task">
                      <i class="search icon"></i>
                    </a>

                    <%= link_to take_task_path(task.id), class: 'ui compact mini orange button' do %>
                      <i class="reply icon"></i>
                      Sair
                    <% end %>

                    <%= link_to take_task_path(task.id), class: 'ui compact mini teal button' do %>
                      <i class="share icon"></i>
                      Participar
                    <% end %>

                    <%= link_to take_task_path(task.id), class: 'ui compact mini blue button' do %>
                      <i class="share icon"></i>
                      Teste
                    <% end %>
                  </p>

                </div>
              </div>
              <div class="extra content">
                <div class="right floated author">
                  <% task.users.each do |u| %>
                    <%= image_tag 'image.svg', class: 'ui avatar image' %> <%= u.name %>
                  <% end %>
                  <%# image_tag 'image.svg', class: 'ui avatar image' %> <!-- Sicrano -->
                </div>
              </div>
            </div>
          <% end %>
          <!-- /CARD -->
          <% end %>
        </td>

        <td></td>
        <td></td>
      </tr>
    </tbody>
  </table>
</div>
<% end %>


<script type="text/javascript">
  $('.tabular.menu .item').tab();

  $(document).ready(function() {
    //$('.sortable').tablesort();
  });

  $('.modal-task').click(function(){
    $('.'+$(this).attr('data-modal')).modal('show');
    return false;
  });

</script>